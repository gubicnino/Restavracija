services:

  spletni-streznik:
    build:
      context: .
      dockerfile_inline: |
          FROM php:apache
          RUN docker-php-ext-install pdo pdo_mysql
          # Omogoƒçi SSL podporo za Azure MySQL
          RUN apt-get update && apt-get install -y ca-certificates
    restart: unless-stopped
    ports:
      - 127.0.0.1:8000:80
    volumes:
      - ./data/php:/var/www/html/
    environment:
      - DB_HOST=restavracija.mysql.database.azure.com
      - DB_PORT=3306
      - DB_USER=student
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=dsr_projekt

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    restart: unless-stopped
    ports:
      - "127.0.0.1:8001:80"
    environment:
      # Povezava na Azure MySQL
      PMA_HOST: restavracija.mysql.database.azure.com
      PMA_PORT: 3306
      PMA_USER: student
      PMA_PASSWORD: ${DB_PASSWORD}
      # SSL konfiguracija
      PMA_ABSOLUTE_URI: http://localhost:8001/
      # SSL konfiguracija - DODAJ TE VRSTICE
      PMA_SSL: 1
      MYSQL_SSL_MODE: REQUIRED